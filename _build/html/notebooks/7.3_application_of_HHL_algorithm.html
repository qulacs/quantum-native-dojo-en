

<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
      <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="Quantum Native Dojo" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="" />
    <meta name="docsearch:version" content="" />
    
      <title>7-3. Portfolio optimization using HHL algorithm &mdash; Quantum Native Dojo  documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-icons.css" type="text/css" />
          <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e7352e39" />
          <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=e15ddae3" />
          <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
          <link rel="stylesheet" type="text/css" href="../_static/colorsets/sphinx-nefertiti-blue.min.css" />
          <link rel="stylesheet" type="text/css" href="../_static/fonts/nunito/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="../_static/fonts/red-hat-mono/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=e15ddae3" />
        <link rel="index" title="Index" href="../genindex.html" />
        <link rel="search" title="Search" href="../search.html" />
        <link rel="top" title="Quantum Native Dojo  documentation" href="#" />
        <link rel="up" title="chapter 7 Quantum phase estimation algorithm and its application" href="7_quantum_phase_estimation.html" />
        <link rel="next" title="Chapter 8: Quantum Search Algorithms" href="8_quantum_search_algorithm.html" />
        <link rel="prev" title="7-2. Harrow-Hassidim-Lloyd (HHL) Algorithm" href="7.2_Harrow-Hassidim-Lloyd_algorithm.html" />
    <style>
      :root {
        --nftt-body-font-family: "Nunito", var(--nftt-font-sans-serif) !important;
        --nftt-font-monospace: "Red Hat Mono", var(--nftt-font-family-monospace) !important;
        --nftt-project-name-font: var(--nftt-body-font-family);
        --nftt-documentation-font: var(--nftt-body-font-family);
        --nftt-doc-headers-font: "Georgia", var(--nftt-documentation-font);}
      h1 *, h2 *, h3 *, h4 *, h5 *, h6 * { font-size: inherit; }
    </style>
  </head>
  <body>
    <header class="navbar navbar-expand-xl navbar-dark nftt-navbar flex-column fixed-top">
      <div class="skip-links container-fluid visually-hidden-focusable overflow-hidden justify-content-start">
        <div class="border-bottom mb-2 pb-2 w-100">
          <a class="d-none d-md-inline-flex p-2 m-1" href="#sidebar-filter">Skip to docs navigation</a>
          <a class="d-inline-flex p-2 m-1" href="#content">Skip to main content</a>
        </div>
      </div>
      <nav class="container-xxl nftt-gutter flex-wrap flex-xl-nowrap" aria-label="Main navigation">
        <div class="nftt-navbar-toggler">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle documentation navigation">
            <i class="bi bi-list"></i>
          </button>
        </div>
          <a href="../index.html"
              
              class="navbar-brand p-0 me-0 md-lg-2"
          ><span class="brand-text">Quantum Native Dojo</span></a>
        
        <div class="d-flex d-xl-none">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttSearch" aria-controls="nfttSearch" aria-label="Search">
            <i class="bi bi-search"></i>
          </button>
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttNavbar" aria-controls="nfttNavbar" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
        
<div class="offcanvas-xl offcanvas-end flex-grow-1" tabindex="-1" id="nfttSearch" aria-labelledby="nfttSearchOffcanvasLabel" data-bs-scroll="true">
  <div class="offcanvas-header px-4 pb-0">
    <h5 class="offcanvas-title fw-bold" id="nfttSearchOffcanvasLabel">Search the documentation</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttSearch"></button>
  </div>
  <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
    <hr class="d-xl-none text-white-50">
    <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
      <li class="nav-item col-12 col-xl-auto">
        <form id="nftt-search-form" action="../search.html" method="get">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search docs" aria-label="Search" aria-describedby="button-search">
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <button class="btn btn-primary" type="submit" id="button-search" aria-label="Search"><i class="bi bi-search"></i></button>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

        <div class="offcanvas-xl offcanvas-end" tabindex="-1" id="nfttNavbar" aria-labelledby="nfttNavbarOffcanvasLabel" data-bs-scroll="true">
          <div class="offcanvas-header px-4 pb-0">
            <div class="offcanvas-title navbar-brand" id="nfttNavbarOffcanvasLabel"><span class="brand-text">Nefertiti for Sphinx</span></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttNavbar"></button>
          </div>
          <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
            <hr class="d-xl-none text-white-50">
            <ul class="navbar-nav flex-row align-items-center flex-wrap ms-lg-auto">
              
              <!-- version_dropdown.html -->

              
              <!-- colorscheme_dropdown.html -->
<li class="nav-item dropdown">
  <a class="nav-link d-flex py-2 px-0 px-xl-2 dropdown-toggle align-items-center" id="snftt-luz" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false" aria-label="Toggle light/dark">
    <i class="bi bi-circle-half" data-snftt-luz-icon-active></i>
    <span id="snftt-luz-text" class="d-xl-none small ms-2">Toggle light/dark</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-luz-text">
    <li>
      <h6 class="dropdown-header">Light/dark</h6>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="light" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-sun" data-snftt-luz-icon="light"></i>
        </span>
        <span class="small ms-3">Light</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="dark" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-moon-stars" data-snftt-luz-icon="dark"></i>
        </span>
        <span class="small ms-3">Dark</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item current d-flex align-items-center" data-snftt-luz="default" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-circle-half" data-snftt-luz-icon="default"></i>
        </span>
        <span class="small ms-3">Default</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
  </ul>
</li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container-fluid">
      <div class="nftt-gutter nftt-page">
        <aside class="nftt-sidebar">
          <div class="nftt-sidebar-content">
            <div class="title d-none d-xl-block">
              <i class="bi bi-book"></i>&nbsp;&nbsp;<span>Index</span>
            </div>
            <div id="sidebar" tabindex="-1" class="offcanvas-xl offcanvas-start" aria-labelledby="nfttSidebarOffcanvasLabel">
                <!-- danirus sidebartemplate: "globaltoc.html" --><div class="offcanvas-header border-bottom">
  <h5 class="offcanvas-title fw-bold" id="nfttSidebarOffcanvasLabel">
    Table of contents
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#sidebar"></button>
</div>

<div class="offcanvas-body">
  <nav class="toc" aria-label="Main menu">
    <div class="mb-3 p-1 pt-3 pb-4 border-bottom">
      <input id="sidebar-filter" type="text" name="filter" class="form-control form-control-sm" placeholder="filter" aria-label="filter">
    </div>
    <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="0_prologue.html">Chapter 0: What is a Quantum Computer ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_quantum_information_foundation.html">Chapter 1: Fundamentals of Quantum Information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="1.1_qubit_representation.html">1-1. Qubit Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2_qubit_operations.html">1-2. Qubit Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3_multiqubit_representation_and_operations.html">1-3. Multiqubit representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3_multiqubit_representation_and_operations.html#Column:-What-is-a-universal-gate-set?">Column: What is a universal gate set?</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.4_quantum_circuit_diagram.html">1-4. Quantum Circuit Diagram</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2_introduction_to_quantum_algorithms.html">Chapter 2: Introduction to Quantum Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="2.1_NISQ_and_long_term.html">2-1. NISQ algorithm and long-term algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.2_Hadamard_test.html">2-2. Hadamard test</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.3_quantum_Fourier_transform.html">2-3. Quantum Fourier transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.4_phase_estimation_beginner.html">2-4. Phase Estimation Algorithm（Introductory）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3_execution_environments_of_quantum_algorithms.html">Chapter 3: Execution Environment for Quantum Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3.1_Qulacs_tutorial.html">3-1. Qulacs_tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="3.2_Qiskit_IBMQ.html">3-2. Qiskit_IBMQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4_quantum_dynamics_simulation.html">Chapter4 Quantum dynamics simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="4.1_quantum_simulation.html">4-1. Quantum Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="4.2_trotter_decomposition.html">4-2. Trotter Decomposition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="5_VQC_based_algorithms.html">Chapter 5 Algorithms Based on Variational Quantum Circuits</a><ul>
<li class="toctree-l2"><a class="reference internal" href="5.1_variational_quantum_eigensolver.html">5-1. Variational Quantum Eigensolver（VQE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="5.2_Quantum_Circuit_Learning.html">5-2. Quantum Circuit Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="5.3_quantum_approximate_optimazation_algorithm.html">5-3. Quantum Approximate Optimazation Algorithm (QAOA)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="6_quantum_chemistry_calculation.html">Chapter 6 Quantum chemistry calculation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="6.1_openfermion_basics.html">6-1. OpenFermion Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="6.2_qp_VQE.html">6-2. Variational Quantum Eigensolver (VQE) Implementation using QURI Parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="6.3_subspace_search_VQE.html">6-3. Calculation of Excited States using Subspace-Search Variational Quantum Eigensolver</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="7_quantum_phase_estimation.html">chapter 7 Quantum phase estimation algorithm and its application</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="7.1_quantum_phase_estimation_detailed.html">7-1. Quantum Phase Estimation (QPE) Algorithm Detailed：Hydrogen Molecule as Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="7.2_Harrow-Hassidim-Lloyd_algorithm.html">7-2. Harrow-Hassidim-Lloyd (HHL) Algorithm</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7-3. Portofolio Optimization by HHL Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="8_quantum_search_algorithm.html">Chapter 8: Quantum Search Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="8.1_oracle.html">8-1. oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.2_Grovers_algorithm.html">8-2. Grover’s algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="9_quantum_error_correction.html">Chapter 9 Quantum Error Correction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="9.1_error_correction.html">9-1. classical error</a></li>
<li class="toctree-l2"><a class="reference internal" href="9.2_quantum_error_correction.html">9-2. quantum error</a></li>
</ul>
</li>
</ul>

  </nav>
  <template data-toggle-item-template>
    <button class="btn btn-sm btn-link toctree-expand" type="button">
      <i class="bi bi-caret-right"></i>
      <span class="visually-hidden">Toggle menu contents</span>
    </button>
  </template>
</div>
            </div>
          </div>
        </aside>
        <article id="content" class="nftt-content" role="main">
    <section id="7-3.-Portfolio-optimization-using-HHL-algorithm">
<h1>7-3. Portfolio optimization using HHL algorithm<a class="headerlink" href="#7-3.-Portfolio-optimization-using-HHL-algorithm" title="Link to this heading">¶</a></h1>
<p>In this section, let us calculate the optimal portfolio (asset allocation) based on the data of past stock price fluctuations, referring to the paper [1]. Portfolio optimization is one of the problems that is expected to be solved faster than before by using the HHL algorithm learned in <a class="reference internal" href="7.1_quantum_phase_estimation_detailed.html"><span class="doc">section 7-1</span></a>. Specifically, this time, we consider the problem of what kind of asset allocation will give the highest return with the lowest risk when investing in
stocks of the four GAFA (Google, Apple, Facebook, and Amazon) companies.</p>
<section id="Stock-Price-Data-Acquisition">
<h2>Stock Price Data Acquisition<a class="headerlink" href="#Stock-Price-Data-Acquisition" title="Link to this heading">¶</a></h2>
<p>First, we obtain the stock price data of each company.</p>
<ul class="simple">
<li><p>Use daily data of GAFA 4 companies</p></li>
<li><p>To obtain stock price data, use pandas_datareader to obtain from Yahoo! Finance database.</p></li>
<li><p>Adjusted closing price in dollars (Adj. Close) is used for the stock price.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas_datareader</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">pdr</span>
<span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yf</span><span class="o">.</span><span class="n">pdr_override</span><span class="p">()</span>
<span class="n">y_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GOOG&#39;</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;META&#39;</span><span class="p">,</span> <span class="s1">&#39;AMZN&#39;</span><span class="p">]</span>

<span class="n">startdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="n">y_symbols</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">enddate</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">][</span><span class="n">y_symbols</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[*********************100%%**********************]  4 of 4 completed
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GOOG</th>
      <th>AAPL</th>
      <th>META</th>
      <th>AMZN</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-12-23</th>
      <td>89.809998</td>
      <td>131.127060</td>
      <td>118.040001</td>
      <td>85.250000</td>
    </tr>
    <tr>
      <th>2022-12-27</th>
      <td>87.930000</td>
      <td>129.307236</td>
      <td>116.879997</td>
      <td>83.040001</td>
    </tr>
    <tr>
      <th>2022-12-28</th>
      <td>86.459999</td>
      <td>125.339409</td>
      <td>115.620003</td>
      <td>81.820000</td>
    </tr>
    <tr>
      <th>2022-12-29</th>
      <td>88.949997</td>
      <td>128.889572</td>
      <td>120.260002</td>
      <td>84.180000</td>
    </tr>
    <tr>
      <th>2022-12-30</th>
      <td>88.730003</td>
      <td>129.207779</td>
      <td>120.339996</td>
      <td>84.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;META&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;GOOG&#39;</span><span class="p">,</span> <span class="s1">&#39;AMZN&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;Date&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_7.3_application_of_HHL_algorithm_4_1.png" src="../_images/notebooks_7.3_application_of_HHL_algorithm_4_1.png" />
</div>
</div>
<p>*The reason why the four stocks are divided into two groups here is because the stock price values are close to each other and easy to see when plotting, and there is no deeper meaning.</p>
</section>
<section id="Data-Preprocessing">
<h2>Data Preprocessing<a class="headerlink" href="#Data-Preprocessing" title="Link to this heading">¶</a></h2>
<p>Next, the acquired stock prices are converted to daily returns to obtain some statistics.</p>
<section id="Conversion-to-Daily-Returns">
<h3>Conversion to Daily Returns<a class="headerlink" href="#Conversion-to-Daily-Returns" title="Link to this heading">¶</a></h3>
<p>The daily return (rate of change) <span class="math notranslate nohighlight">\(y_t\)</span> (where <span class="math notranslate nohighlight">\(t\)</span> is the date) of an individual stock is defined as follows</p>
<div class="math notranslate nohighlight">
\[y_t = \frac{P_t - P_{t-1}}{P_{t-1}}\]</div>
<p>This is obtained with the <code class="docutils literal notranslate"><span class="pre">pct_change()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">pandas</span> <span class="pre">DataFrame</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">daily_return</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">daily_return</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GOOG</th>
      <th>AAPL</th>
      <th>META</th>
      <th>AMZN</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-12-23</th>
      <td>0.017562</td>
      <td>-0.002798</td>
      <td>0.007855</td>
      <td>0.017425</td>
    </tr>
    <tr>
      <th>2022-12-27</th>
      <td>-0.020933</td>
      <td>-0.013878</td>
      <td>-0.009827</td>
      <td>-0.025924</td>
    </tr>
    <tr>
      <th>2022-12-28</th>
      <td>-0.016718</td>
      <td>-0.030685</td>
      <td>-0.010780</td>
      <td>-0.014692</td>
    </tr>
    <tr>
      <th>2022-12-29</th>
      <td>0.028799</td>
      <td>0.028324</td>
      <td>0.040131</td>
      <td>0.028844</td>
    </tr>
    <tr>
      <th>2022-12-30</th>
      <td>-0.002473</td>
      <td>0.002469</td>
      <td>0.000665</td>
      <td>-0.002138</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[145.07449341, 179.95387268, 338.54000854, 170.40449524],
       [144.41650391, 177.66999817, 336.52999878, 167.52200317],
       [137.65350342, 172.94400024, 324.17001343, 164.35699463],
       ...,
       [ 86.45999908, 125.33940887, 115.62000275,  81.81999969],
       [ 88.94999695, 128.88957214, 120.26000214,  84.18000031],
       [ 88.73000336, 129.20777893, 120.33999634,  84.        ]])
</pre></div></div>
</div>
</section>
<section id="Expected-Returns">
<h3>Expected Returns<a class="headerlink" href="#Expected-Returns" title="Link to this heading">¶</a></h3>
<p>Find the expected return <span class="math notranslate nohighlight">\(\vec R\)</span> for each stock. Here we use the arithmetic mean of the historical returns:</p>
<div class="math notranslate nohighlight">
\[\vec R = \frac{1}{T} \sum_{t= 1}^{T} \vec y_t\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_return</span> <span class="o">=</span> <span class="n">daily_return</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">252</span> <span class="c1"># Multiply by 252 annual operating days for annualization</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expected_return</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GOOG   -0.419937
AAPL   -0.270522
META   -0.822084
AMZN   -0.586943
dtype: float64
</pre></div></div>
</div>
</section>
<section id="Variance/Covariance-Matrix">
<h3>Variance/Covariance Matrix<a class="headerlink" href="#Variance/Covariance-Matrix" title="Link to this heading">¶</a></h3>
<p>The sample unbiased variance/covariance matrix <span class="math notranslate nohighlight">\(\Sigma\)</span> of the returns is defined by</p>
<div class="math notranslate nohighlight">
\[\Sigma = \frac{1}{T-1} \sum_{t=1}^{T} ( \vec y_t -\vec R ) (\vec y_t -\vec R )^T\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span> <span class="o">=</span> <span class="n">daily_return</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span> <span class="o">*</span> <span class="mi">252</span> <span class="c1"># For annualized basis</span>
<span class="n">display</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GOOG</th>
      <th>AAPL</th>
      <th>META</th>
      <th>AMZN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GOOG</th>
      <td>0.150897</td>
      <td>0.109549</td>
      <td>0.170553</td>
      <td>0.140956</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>0.109549</td>
      <td>0.127250</td>
      <td>0.136161</td>
      <td>0.124414</td>
    </tr>
    <tr>
      <th>META</th>
      <td>0.170553</td>
      <td>0.136161</td>
      <td>0.414463</td>
      <td>0.195457</td>
    </tr>
    <tr>
      <th>AMZN</th>
      <td>0.140956</td>
      <td>0.124414</td>
      <td>0.195457</td>
      <td>0.251178</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="Portfolio-Optimization">
<h2>Portfolio Optimization<a class="headerlink" href="#Portfolio-Optimization" title="Link to this heading">¶</a></h2>
<p>Now that we are ready, let’s tackle portfolio optimization.</p>
<p>First, the portfolio (i.e., asset allocation) is represented by a 4-component vector <span class="math notranslate nohighlight">\(\vec{w} = (w_0,w_1,w_2,w_3)^T\)</span>. For example, if <span class="math notranslate nohighlight">\(\vec{w}=(1,0,0,0)\)</span>, it means a portfolio with 100% of its assets invested in Google stock.</p>
<p>Let us consider a portfolio that satisfies the following equation.</p>
<div class="math notranslate nohighlight">
\[\min_{\vec{w}} \frac{1}{2} \vec{w}^T \Sigma \vec{w} \:\:\: \text{s.t.} \:\: \vec R^T \vec w = \mu , \: \vec 1^T \vec w =1\]</div>
<p>This formula means</p>
<ul class="simple">
<li><p>“minimizing the variance of the portfolio’s return”</p></li>
</ul>
<p>under the following condition</p>
<ul class="simple">
<li><p>“The expected return (average of returns) of the portfolio is <span class="math notranslate nohighlight">\(\mu\)</span>”</p></li>
<li><p>“the sum of the weights invested in the portfolio is 1” (<span class="math notranslate nohighlight">\(\vec 1 = (1,1,1,1)^T\)</span>)</p></li>
</ul>
<p>In other words, the best portfolio is the one that minimizes the variance (risk) of the desired future return of only <span class="math notranslate nohighlight">\(\mu\)</span> as much as possible. Such a problem setup is called <a class="reference external" href="https://en.wikipedia.org/wiki/Modern_portfolio_theory">Markowitz’s mean-variance approach</a> and is one of the foundational ideas of modern financial engineering.</p>
<p>Using Lagrange’s undetermined multiplier method, <span class="math notranslate nohighlight">\(\vec{w}\)</span> satisfying the above conditions can be obtained by solving the linear equation</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gather}
W
\left(
\begin{array}{c}
\eta \\
\theta \\
\vec w
\end{array}
\right)
=
\left(
\begin{array}{c}
 \mu \\
 1 \\
\vec 0
\end{array}
\right),  \tag{1}\\
W =
\left(
\begin{array}{ccc}
0 &amp; 0 &amp; \vec R^T \\
0 &amp; 0 &amp; \vec 1^T \\
\vec{R} &amp;\vec 1 &amp; \Sigma
\end{array}
\right)
\end{gather}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\eta, \theta\)</span> are the parameters of Lagrange’s undetermined multiplier method. Therefore, to find the optimal portfolio <span class="math notranslate nohighlight">\(\vec w\)</span>, we can solve the simultaneous equation (1) for <span class="math notranslate nohighlight">\(\vec w\)</span>. We have now attributed the portfolio optimization problem to a linear equation for which the HHL algorithm can be used.</p>
<section id="Creating-the-matrix-W">
<h3>Creating the matrix W<a class="headerlink" href="#Creating-the-matrix-W" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">expected_return</span><span class="o">.</span><span class="n">values</span>
<span class="n">Pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">values</span>

<span class="n">row1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">row2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Pi</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">row3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">R</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Pi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">S</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">row3</span><span class="p">])</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[ 0.          0.         -0.41993745 -0.27052205 -0.8220839  -0.58694271]
 [ 0.          0.          1.          1.          1.          1.        ]
 [-0.41993745  1.          0.15089651  0.10954939  0.17055346  0.14095575]
 [-0.27052205  1.          0.10954939  0.12724979  0.13616129  0.12441403]
 [-0.8220839   1.          0.17055346  0.13616129  0.41446314  0.19545675]
 [-0.58694271  1.          0.14095575  0.12441403  0.19545675  0.25117849]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_return</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GOOG   -0.419937
AAPL   -0.270522
META   -0.822084
AMZN   -0.586943
dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Check eigenvalue of W -&gt; fits in [-pi, pi]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">W</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-1.94743143 -0.30935002  0.03004076  0.09772754  0.42730033  2.64550076]
</pre></div></div>
</div>
</section>
<section id="Creating-the-right-hand-side-vector">
<h3>Creating the right-hand side vector<a class="headerlink" href="#Creating-the-right-hand-side-vector" title="Link to this heading">¶</a></h3>
<p>Given the expected return <span class="math notranslate nohighlight">\(\mu\)</span> of the portfolio below, we can calculate the least risky portfolio that will yield such a return. The <span class="math notranslate nohighlight">\(\mu\)</span> can be set freely. In general, the higher the expected return, the greater the risk, but we will use 10% as an example (this is a very bearish one, since it is a time when GAFA stocks are going gangbusters).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># Portfolio returns (parameters to be put in hand)</span>
<span class="n">xi</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mu_xi_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu</span><span class="p">,</span> <span class="n">xi</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R</span><span class="p">))</span> <span class="c1">## Vector on the right side of equation (1)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mu_xi_0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.1 1.  0.  0.  0.  0. ]
</pre></div></div>
</div>
</section>
<section id="Extend-the-matrix-so-that-it-can-be-handled-by-a-quantum-system">
<h3>Extend the matrix so that it can be handled by a quantum system<a class="headerlink" href="#Extend-the-matrix-so-that-it-can-be-handled-by-a-quantum-system" title="Link to this heading">¶</a></h3>
<p>Since <span class="math notranslate nohighlight">\(W\)</span> is 6-dimensional, it is computable in a quantum system with 3 qubits (<span class="math notranslate nohighlight">\(2^3 = 8\)</span>). Therefore, we also make a matrix and a vector with the extended two dimensions filled with zeros.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbit</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">## Number of bits used for state</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">nbit</span>

<span class="n">W_enl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span> <span class="c1">## enl stands for enlarged</span>
<span class="n">W_enl</span><span class="p">[:</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">mu_xi_0_enl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">mu_xi_0_enl</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">mu_xi_0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mu_xi_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We are now ready to solve the simultaneous equation (1).</p>
</section>
</section>
<section id="Calculating-the-minimum-variance-portfolio-using-the-HHL-algorithm">
<h2>Calculating the minimum variance portfolio using the HHL algorithm<a class="headerlink" href="#Calculating-the-minimum-variance-portfolio-using-the-HHL-algorithm" title="Link to this heading">¶</a></h2>
<p>Now, let us solve the simultaneous linear equations (1) using the HHL algorithm. First, as a preliminary step, we prepare the following functions.</p>
<ul class="simple">
<li><p>A function <code class="docutils literal notranslate"><span class="pre">input_state_gate</span></code> that returns a quantum circuit that converts the quantum state to <span class="math notranslate nohighlight">\(|0\cdots0\rangle \to \sum_i x_i |i \rangle\)</span> according to the classical data <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> This function should be built using the qRAM concept, but since we are using a simulator, we will implement it as a non-unitary gate this time. Also, standardization is ignored.)</p></li>
<li><p>Function <code class="docutils literal notranslate"><span class="pre">add_QFT_gate</span></code> adds a gate to perform quantum Fourier transform.</p></li>
<li><p>Function <code class="docutils literal notranslate"><span class="pre">get_phase_estimate_circuit</span></code> returns a phase estimation gate.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>
<span class="kn">from</span> <span class="nn">quri_parts.circuit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>


<span class="k">def</span> <span class="nf">add_QFT_gate</span><span class="p">(</span>
    <span class="n">circuit</span><span class="p">:</span> <span class="n">QuantumCircuit</span><span class="p">,</span>
    <span class="n">start_bit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_bit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">inverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Making a gate which performs quantum Fourier transfromation between start_bit to end_bit.</span>
<span class="sd">    (Definition below is the case when start_bit = 0 and end_bit=n-1)</span>
<span class="sd">    We associate an integer  j = j_{n-1}...j_0 to quantum state |j_{n-1}...j_0&gt;.</span>
<span class="sd">    We define QFT as</span>
<span class="sd">    |k&gt; = |k_{n-1}...k_0&gt; = 1/sqrt(2^n) sum_{j=0}^{2^n-1} exp(2pi*i*(k/2^n)*j) |j&gt;.</span>
<span class="sd">    then, |k_m &gt; = 1/sqrt(2)*(|0&gt; + exp(i*2pi*0.j_{n-1-m}...j_0)|1&gt; )</span>
<span class="sd">    When Inverse=True,  the gate represents Inverse QFT,</span>
<span class="sd">    |k&gt; = |k_{n-1}...k_0&gt; = 1/sqrt(2^n) sum_{j=0}^{2^n-1} exp(-2pi*i*(k/2^n)*j) |j&gt;.</span>

<span class="sd">    Args:</span>
<span class="sd">      int start_bit:  first index of qubits where we apply QFT.</span>
<span class="sd">      int end_bit:    last  index of qubits where we apply QFT.</span>
<span class="sd">      bool Inverse: When True, the gate perform inverse-QFT ( = QFT^{\dagger}).</span>
<span class="sd">    Returns:</span>
<span class="sd">      qulacs.QuantumGate: QFT gate which acts on a region between start_bit and end_bit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">end_bit</span> <span class="o">-</span> <span class="n">start_bit</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end_bit</span><span class="p">,</span> <span class="n">start_bit</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">add_H_gate</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">control</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_bit</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
            <span class="n">angle</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">inverse</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">target</span><span class="o">-</span><span class="n">control</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">circuit</span><span class="o">.</span><span class="n">add_U1_gate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">controlled_on</span><span class="o">=</span><span class="p">{</span><span class="n">control</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">add_SWAP_gate</span><span class="p">(</span><span class="n">start_bit</span><span class="o">+</span><span class="n">s</span><span class="p">,</span> <span class="n">end_bit</span><span class="o">-</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_phase_estimate_circuit</span><span class="p">(</span>
    <span class="n">n_total_qubits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">unitary_matrix</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">],</span>
    <span class="n">start_qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">n_phase_estimate_qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>

    <span class="n">n_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">unitary_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">n_p</span> <span class="o">=</span> <span class="n">n_phase_estimate_qubit</span>

    <span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_total_qubits</span><span class="p">)</span>

    <span class="c1">## ------- Hadamard gate on register bit -------</span>
    <span class="k">for</span> <span class="n">register</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_qubit</span><span class="p">,</span> <span class="n">start_qubit</span><span class="o">+</span><span class="n">n_p</span><span class="p">):</span> <span class="c1">## from nbit to nbit+reg_nbit-1</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">add_H_gate</span><span class="p">(</span><span class="n">register</span><span class="p">)</span>

    <span class="c1">## ------- Implement phase estimation -------</span>
    <span class="c1">## U := e^{i*A*t) and its eigenvalues are diag( {e^{i*2pi*phi_k}}_{k=0, ... N-1)).</span>
    <span class="c1">## Implement \sum_j |j&gt;&lt;j| exp(i*A*t*j) to register bits</span>

    <span class="k">for</span> <span class="n">register</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_qubit</span><span class="p">,</span> <span class="n">start_qubit</span><span class="o">+</span><span class="n">n_p</span><span class="p">):</span>
        <span class="c1">## Implement U^{2^{register-nbit}}.</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">add_UnitaryMatrix_gate</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_s</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_power</span><span class="p">(</span><span class="n">unitary_matrix</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">register</span> <span class="o">-</span> <span class="n">start_qubit</span><span class="p">)),</span>
            <span class="n">controlled_on</span><span class="o">=</span><span class="p">{</span><span class="n">register</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="n">add_QFT_gate</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">start_qubit</span><span class="p">,</span> <span class="n">start_qubit</span><span class="o">+</span><span class="n">n_phase_estimate_qubit</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
<p>First, set the necessary parameters for the HHL algorithm. Set the clock register quantum bit number <code class="docutils literal notranslate"><span class="pre">reg_nbit</span></code> to <code class="docutils literal notranslate"><span class="pre">7</span></code> and the coefficient <code class="docutils literal notranslate"><span class="pre">scale_fac</span></code> used for scaling the matrix <span class="math notranslate nohighlight">\(W\)</span> to <code class="docutils literal notranslate"><span class="pre">1</span></code> (i.e., do not scale it). Also, the coefficient <span class="math notranslate nohighlight">\(c\)</span> used for the control rotation gate is kept at half of the smallest number of nonzeros that can be represented by the <code class="docutils literal notranslate"><span class="pre">reg_nbit</span></code> bits.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of registers used for phase estimation</span>
<span class="n">reg_nbit</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1">## Factor to scale W_enl</span>
<span class="n">scale_fac</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">W_enl_scaled</span> <span class="o">=</span> <span class="n">scale_fac</span> <span class="o">*</span> <span class="n">W_enl</span>

<span class="c1">## Minimum value to be assumed as an eigenvalue of W_enl_scaled</span>
<span class="c1">## In this case, since the projection succeeds 100%, we set the value as a constant multiple of the minimum value that can be represented by the register.</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">reg_nbit</span><span class="p">)</span> <span class="p">))</span>
</pre></div>
</div>
</div>
<p>The core of the HHL algorithm will be written. In this article, we use the <code class="docutils literal notranslate"><span class="pre">quri_parts.qulacs.simulator</span></code>, so various simplifications have been made. This is an implementation to get a sense of how the HHL algorithm works.</p>
<ul class="simple">
<li><p>The part of preparing the input state <span class="math notranslate nohighlight">\(|\mathbf{b}\rangle\)</span> is simplified.</p></li>
<li><p>The part of <span class="math notranslate nohighlight">\(e^{iA}\)</span> used in the quantum phase estimation algorithm is the diagonalization of <span class="math notranslate nohighlight">\(A\)</span> by a classical computer.</p></li>
<li><p>Control rotation gate that takes inverses is also implemented by a classical computer..</p></li>
<li><p>Measure the projection to the auxiliary bit <span class="math notranslate nohighlight">\(|0 \rangle{}_{S}\)</span> and treat only the states where the measurement result <code class="docutils literal notranslate"><span class="pre">0</span></code> is obtained. (For convenience of implementation, the definition of the action of the control rotation gate is reversed from <a class="reference internal" href="7.1_quantum_phase_estimation_detailed.html"><span class="doc">section 7-1</span></a>)</p></li>
</ul>
<section id="Construct-the-HHL-circuit">
<h3>Construct the HHL circuit<a class="headerlink" href="#Construct-the-HHL-circuit" title="Link to this heading">¶</a></h3>
<p>Here, we create an HHL quantum circuit. Starting from the 0th bit, we have the bits in the space where A acts (0th ~ nbit-1th), the register bits (nbit th ~ nbit+reg_nbit-1 th), and the bits for conditional rotation (nbit+reg_nbit th).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">quri_parts.qulacs.simulator</span> <span class="kn">import</span> <span class="n">run_circuit</span>
<span class="kn">from</span> <span class="nn">quri_parts.circuit</span> <span class="kn">import</span> <span class="n">inverse_circuit</span>

<span class="k">def</span> <span class="nf">get_condition_rotation_gate</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_bit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_reg_bit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;conditional rotation circuit</span>

<span class="sd">    The eigenvalue of A*t corresponding to the register |phi&gt;</span>
<span class="sd">    is l = 2pi * 0. phi = 2pi * (phi / 2**reg_nbit).</span>
<span class="sd">    The definition of conditional rotation is (opposite of the text)</span>
<span class="sd">    |phi&gt;|0&gt; -&gt; C/(lambda)|phi&gt;|0&gt; + sqrt(1 - C^2/(lambda)^2)|phi&gt;|1&gt;.</span>
<span class="sd">    Since this is a classical simulation, the gate is made explicitly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">condrot_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n_reg_bit</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n_reg_bit</span><span class="o">+</span><span class="mi">1</span><span class="p">))),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">reg_nbit</span><span class="p">):</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n_reg_bit</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">index_0</span> <span class="o">=</span> <span class="n">index</span> <span class="c1">## integer which represents |index&gt;|0&gt;</span>
        <span class="n">index_1</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="n">n_reg_bit</span> <span class="c1">## integer which represents |index&gt;|1&gt;</span>
        <span class="k">if</span> <span class="n">lam</span> <span class="o">&gt;=</span> <span class="n">C</span><span class="p">:</span>
            <span class="c1">## Since we have scaled the eigenvalues in [-pi, pi] beforehand,</span>
            <span class="c1">## [pi, 2pi] corresponds to a negative eigenvalue</span>
            <span class="k">if</span> <span class="n">lam</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">condrot_mat</span><span class="p">[</span><span class="n">index_0</span><span class="p">,</span> <span class="n">index_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span> <span class="o">/</span> <span class="n">lam</span>
            <span class="n">condrot_mat</span><span class="p">[</span><span class="n">index_1</span><span class="p">,</span> <span class="n">index_0</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
            <span class="n">condrot_mat</span><span class="p">[</span><span class="n">index_0</span><span class="p">,</span> <span class="n">index_1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
            <span class="n">condrot_mat</span><span class="p">[</span><span class="n">index_1</span><span class="p">,</span> <span class="n">index_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span> <span class="o">/</span> <span class="n">lam</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">condrot_mat</span><span class="p">[</span><span class="n">index_0</span><span class="p">,</span> <span class="n">index_0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">condrot_mat</span><span class="p">[</span><span class="n">index_1</span><span class="p">,</span> <span class="n">index_1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">add_UnitaryMatrix_gate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_bit</span><span class="p">,</span> <span class="n">n_bit</span><span class="o">+</span><span class="n">n_reg_bit</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">condrot_mat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circuit</span>

<span class="k">def</span> <span class="nf">get_HHL_circuit</span><span class="p">(</span>
    <span class="n">n_bit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">n_reg_bit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">hermitian_matrix</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>

    <span class="n">D</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">hermitian_matrix</span><span class="p">)</span>
    <span class="n">U_mat</span> <span class="o">=</span> <span class="n">P</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="mf">1.</span><span class="n">j</span> <span class="o">*</span> <span class="n">D</span> <span class="p">))</span> <span class="o">@</span> <span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>

    <span class="n">total_qubits</span> <span class="o">=</span> <span class="n">n_bit</span> <span class="o">+</span> <span class="n">n_reg_bit</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">total_qubits</span><span class="p">)</span>

    <span class="n">phase_estimation_circuit</span> <span class="o">=</span> <span class="n">get_phase_estimate_circuit</span><span class="p">(</span>
        <span class="n">total_qubits</span><span class="p">,</span>
        <span class="n">U_mat</span><span class="p">,</span>
        <span class="n">start_qubit</span><span class="o">=</span><span class="n">n_bit</span><span class="p">,</span>
        <span class="n">n_phase_estimate_qubit</span><span class="o">=</span><span class="n">n_reg_bit</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">condition_rotation_circuit</span> <span class="o">=</span> <span class="n">get_condition_rotation_gate</span><span class="p">(</span>
        <span class="n">total_qubits</span><span class="p">,</span> <span class="n">n_bit</span><span class="p">,</span> <span class="n">n_reg_bit</span>
    <span class="p">)</span>

    <span class="n">circuit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">phase_estimation_circuit</span><span class="p">)</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">condition_rotation_circuit</span><span class="p">)</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inverse_circuit</span><span class="p">(</span><span class="n">phase_estimation_circuit</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hhl_circuit</span> <span class="o">=</span> <span class="n">get_HHL_circuit</span><span class="p">(</span><span class="n">nbit</span><span class="p">,</span> <span class="n">reg_nbit</span><span class="p">,</span> <span class="n">W_enl_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Run-the-HHL-quantum-circuit-and-retrieve-the-result">
<h3>Run the HHL quantum circuit and retrieve the result<a class="headerlink" href="#Run-the-HHL-quantum-circuit-and-retrieve-the-result" title="Link to this heading">¶</a></h3>
<p>Here, we prepare the state for us to send into the HHL circuit. We use the simulator provided by <code class="docutils literal notranslate"><span class="pre">quri_parts.qulacs.simulator</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## ------ Prepare vector b input to the 0th~(nbit-1)th bit ------</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">reg_nbit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))],</span>
    <span class="n">mu_xi_0_enl</span>
<span class="p">)</span>
<span class="n">updated_state</span> <span class="o">=</span> <span class="n">run_circuit</span><span class="p">(</span><span class="n">hhl_circuit</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After the acting the circuit on the state, we need to project the state to the <span class="math notranslate nohighlight">\(|0\rangle\)</span> subspace of the auxiliary bit. The 0th to (nbit-1)th bit then corresponds to the calculation result |x&gt;.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">projector</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hhl_circuit</span><span class="o">.</span><span class="n">qubit_count</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">final_state</span> <span class="o">=</span> <span class="n">projector</span> <span class="o">@</span> <span class="n">updated_state</span>

<span class="c1">## The 0th to (nbit-1)th bit corresponds to the calculation result |x&gt;.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">final_state</span><span class="p">[:</span><span class="mi">2</span><span class="o">**</span><span class="n">nbit</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
<span class="n">x_HHL</span> <span class="o">=</span> <span class="n">result</span><span class="o">/</span><span class="n">C</span> <span class="o">*</span> <span class="n">scale_fac</span>
</pre></div>
</div>
</div>
</section>
<section id="Compare-results">
<h3>Compare results<a class="headerlink" href="#Compare-results" title="Link to this heading">¶</a></h3>
<p>Comparing the solution <code class="docutils literal notranslate"><span class="pre">x_HHL</span></code> by the HHL algorithm with the solution <code class="docutils literal notranslate"><span class="pre">x_exact</span></code> by diagonalization of the usual classical computation, we can see that they are roughly in agreement. (There are several parameters that determine the accuracy of the HHL algorithm (e.g. <code class="docutils literal notranslate"><span class="pre">reg_nbit</span></code>), so please try changing them and experiment with them).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Exact solution</span>
<span class="n">x_exact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">W_enl</span><span class="p">,</span> <span class="n">mu_xi_0_enl</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HHL:  &quot;</span><span class="p">,</span> <span class="n">x_HHL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exact:&quot;</span><span class="p">,</span> <span class="n">x_exact</span><span class="p">)</span>
<span class="n">rel_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x_HHL</span><span class="o">-</span> <span class="n">x_exact</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x_exact</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rel_error&quot;</span><span class="p">,</span> <span class="n">rel_error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
HHL:   [-0.2591962  -0.18557542  0.49450532  1.50115768 -0.54142008 -0.46074174  0.          0.        ]
exact: [-0.25188165 -0.1853244   0.37818531  1.58529401 -0.51953462 -0.4439447   0.          0.        ]
rel_error 0.08155603917693245
</pre></div></div>
</div>
<p>If we take out only the actual weighting part</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_opt_HHL</span> <span class="o">=</span> <span class="n">x_HHL</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="n">w_opt_exact</span> <span class="o">=</span> <span class="n">x_exact</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="n">w_opt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">w_opt_exact</span><span class="p">,</span> <span class="n">w_opt_HHL</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;exact&#39;</span><span class="p">,</span> <span class="s1">&#39;HHL&#39;</span><span class="p">])</span>
<span class="n">w_opt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>exact</th>
      <th>HHL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GOOG</th>
      <td>0.378185</td>
      <td>0.494505</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>1.585294</td>
      <td>1.501158</td>
    </tr>
    <tr>
      <th>META</th>
      <td>-0.519535</td>
      <td>-0.541420</td>
    </tr>
    <tr>
      <th>AMZN</th>
      <td>-0.443945</td>
      <td>-0.460742</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_opt</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_7.3_application_of_HHL_algorithm_37_1.png" src="../_images/notebooks_7.3_application_of_HHL_algorithm_37_1.png" />
</div>
</div>
<p>*Stocks with negative weights represent “short selling” (borrowing shares and selling them. It is a technique whereby profits can be made during periods of falling stock prices). In this case, the target return was set at 10%, which is quite small for GAFA stocks (expected return of 30-40% alone), so short selling is likely to have lowered the overall expected return.</p>
</section>
</section>
<section id="Appendix:-Back-Testing">
<h2>Appendix: Back Testing<a class="headerlink" href="#Appendix:-Back-Testing" title="Link to this heading">¶</a></h2>
<p>The verification of an investment rule derived from historical data using subsequent data is called “back-testing,” and is important for measuring the effectiveness of the investment rule. In this section, we will observe how much asset values change in the following year, 2018, when invested in a portfolio constructed from 2017 data as described above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yf</span><span class="o">.</span><span class="n">pdr_override</span><span class="p">()</span>
<span class="n">y_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GOOG&#39;</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;META&#39;</span><span class="p">,</span> <span class="s1">&#39;AMZN&#39;</span><span class="p">]</span>

<span class="n">startdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="n">y_symbols</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">enddate</span><span class="p">)</span>

<span class="n">df2022</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">][</span><span class="n">y_symbols</span><span class="p">]</span>
<span class="n">df2022</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[*********************100%%**********************]  4 of 4 completed
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GOOG</th>
      <th>AAPL</th>
      <th>META</th>
      <th>AMZN</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-12-22</th>
      <td>142.720001</td>
      <td>193.600006</td>
      <td>353.390015</td>
      <td>153.419998</td>
    </tr>
    <tr>
      <th>2023-12-26</th>
      <td>142.820007</td>
      <td>193.050003</td>
      <td>354.829987</td>
      <td>153.410004</td>
    </tr>
    <tr>
      <th>2023-12-27</th>
      <td>141.440002</td>
      <td>193.149994</td>
      <td>357.829987</td>
      <td>153.339996</td>
    </tr>
    <tr>
      <th>2023-12-28</th>
      <td>141.279999</td>
      <td>193.580002</td>
      <td>358.320007</td>
      <td>153.380005</td>
    </tr>
    <tr>
      <th>2023-12-29</th>
      <td>140.929993</td>
      <td>192.529999</td>
      <td>353.959991</td>
      <td>151.940002</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Plot the stock price</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df2022</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;META&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df2022</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;GOOG&#39;</span><span class="p">,</span> <span class="s1">&#39;AMZN&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;Date&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_7.3_application_of_HHL_algorithm_40_1.png" src="../_images/notebooks_7.3_application_of_HHL_algorithm_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Changes in portfolio asset values</span>
<span class="n">pf_value</span> <span class="o">=</span> <span class="n">df2022</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w_opt</span><span class="p">)</span>
<span class="n">pf_value</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>exact</th>
      <th>HHL</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-01-03</th>
      <td>128.187768</td>
      <td>123.985720</td>
    </tr>
    <tr>
      <th>2023-01-04</th>
      <td>128.782543</td>
      <td>124.311268</td>
    </tr>
    <tr>
      <th>2023-01-05</th>
      <td>127.056521</td>
      <td>122.515043</td>
    </tr>
    <tr>
      <th>2023-01-06</th>
      <td>131.919778</td>
      <td>127.037984</td>
    </tr>
    <tr>
      <th>2023-01-09</th>
      <td>132.714873</td>
      <td>127.853714</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Since the initial amount may differ between exact and HHL, we look at returns normalized by the value at the beginning of the period.</span>
<span class="n">pf_value</span><span class="o">.</span><span class="n">exact</span> <span class="o">=</span> <span class="n">pf_value</span><span class="o">.</span><span class="n">exact</span> <span class="o">/</span> <span class="n">pf_value</span><span class="o">.</span><span class="n">exact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pf_value</span><span class="o">.</span><span class="n">HHL</span> <span class="o">=</span> <span class="n">pf_value</span><span class="o">.</span><span class="n">HHL</span> <span class="o">/</span> <span class="n">pf_value</span><span class="o">.</span><span class="n">HHL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pf_value</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
               exact       HHL
Date
2023-12-22  0.851713  0.799935
2023-12-26  0.839405  0.787424
2023-12-27  0.824654  0.770290
2023-12-28  0.827375  0.772570
2023-12-29  0.836015  0.782851
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pf_value</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;Date&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_7.3_application_of_HHL_algorithm_43_1.png" src="../_images/notebooks_7.3_application_of_HHL_algorithm_43_1.png" />
</div>
</div>
<p>The stocks of all GAFA companies except Amazon were soft in 2018, resulting in a loss of roughly -20%. The EXACT solution seems to be somewhat better. Incidentally, since what we originally did was risk minimization, we also calculated the risk for the past year, and the EXACT solution resulted in smaller risk.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pf_value</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span> <span class="c1">## annualized</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
exact    0.409176
HHL      0.435979
dtype: float64
</pre></div></div>
</div>
</section>
<section id="Reference">
<h2>Reference<a class="headerlink" href="#Reference" title="Link to this heading">¶</a></h2>
<p>[1] P. Rebentrost and S. Lloyd, “Quantum computational finance: quantum algorithm for portfolio optimization“, <a class="reference external" href="https://arxiv.org/abs/1811.03975">https://arxiv.org/abs/1811.03975</a></p>
</section>
</section>

</article>
        <aside class="nftt-toc">
          
          <div class="mt-3 mb-1 my-lg-0 ps-xl-3 text-muted">
            <button class="btn btn-link link-dark p-lg-0 mb-2 mb-lg-0 text-decoration-none nftt-toc-toggle d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#tocContents" aria-expanded="false" aria-controls="tocContents"
            >On this page <i class="ms-2 bi bi-chevron-expand"></i></button>
            <div class="title d-none d-lg-block">
              <i class="bi bi-file-earmark-text"></i>&nbsp;&nbsp;<span class="small">On this page</span>
            </div>
            <div class="collapse nftt-toc-collapse" id="tocContents">
              <nav id="TableOfContents">
                <ul>
<li><a class="reference internal" href="#">7-3. Portfolio optimization using HHL algorithm</a><ul>
<li><a class="reference internal" href="#Stock-Price-Data-Acquisition">Stock Price Data Acquisition</a></li>
<li><a class="reference internal" href="#Data-Preprocessing">Data Preprocessing</a><ul>
<li><a class="reference internal" href="#Conversion-to-Daily-Returns">Conversion to Daily Returns</a></li>
<li><a class="reference internal" href="#Expected-Returns">Expected Returns</a></li>
<li><a class="reference internal" href="#Variance/Covariance-Matrix">Variance/Covariance Matrix</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Portfolio-Optimization">Portfolio Optimization</a><ul>
<li><a class="reference internal" href="#Creating-the-matrix-W">Creating the matrix W</a></li>
<li><a class="reference internal" href="#Creating-the-right-hand-side-vector">Creating the right-hand side vector</a></li>
<li><a class="reference internal" href="#Extend-the-matrix-so-that-it-can-be-handled-by-a-quantum-system">Extend the matrix so that it can be handled by a quantum system</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Calculating-the-minimum-variance-portfolio-using-the-HHL-algorithm">Calculating the minimum variance portfolio using the HHL algorithm</a><ul>
<li><a class="reference internal" href="#Construct-the-HHL-circuit">Construct the HHL circuit</a></li>
<li><a class="reference internal" href="#Run-the-HHL-quantum-circuit-and-retrieve-the-result">Run the HHL quantum circuit and retrieve the result</a></li>
<li><a class="reference internal" href="#Compare-results">Compare results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Appendix:-Back-Testing">Appendix: Back Testing</a></li>
<li><a class="reference internal" href="#Reference">Reference</a></li>
</ul>
</li>
</ul>

              </nav>
            </div>
          </div>
          
        </aside>
      </div>
    </div>

    <footer class="nftt-footer">
      <nav id="paginator" class="py-4" aria-label="Documentation navigation">
    <div class="container">
      <ul class="pagination justify-content-between mb-0"><li class="page-item">
            <a href="7.2_Harrow-Hassidim-Lloyd_algorithm.html" class="d-flex px-5 align-items-end" rel="prev" aria-label="Previous page: 7-2. Harrow-Hassidim-Lloyd (HHL) Algorithm">
              <span class="prev-page"><i class="bi bi-caret-left"></i></span>
              <div class="d-flex flex-column">
                <span class="text-small text-start text-muted">Previous</span>
                <span class="underline">7-2. Harrow-Hassidim-Lloyd (HHL) Algorithm</span>
              </div>
            </a>
          </li>
        <li class="page-item ms-auto">
            <a href="8_quantum_search_algorithm.html" class="d-flex px-5 align-items-end" rel="next" aria-label="Next page: Chapter 8: Quantum Search Algorithms">
              <div class="d-flex flex-column">
                <span class="text-small text-end text-start text-muted">Next</span>
                <span class="underline">Chapter 8: Quantum Search Algorithms</span>
              </div>
              <span class="next-page"><i class="bi bi-caret-right"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
  </nav>

      <div class="py-5 px-4 px-md-3">
  <div class="container">
    

    <div class="row">
      <div class="col-lg-12 text-center">
        <a class="brand-text d-inline-flex align-items-center mb-2 text-decoration-none" href="/" aria-label="Nefertiti-for-Sphinx">
          <span class="fs-6 fw-bold">Quantum Native Dojo</span>
        </a>
        
          <ul class="list-unstyled small text-muted">
            <li>2023, Quantum Native Dojo Contributors</li>
          </ul>
        
        
        <div class="built-with pt-2">
          Built with <a href="http://sphinx-doc.org">Sphinx 7.2.6</a> and <a href="https://github.com/danirus/sphinx-nefertiti">Nefertiti 0.3.0</a>
        </div>
        
      </div>
    </div>
  </div>
</div>
    </footer>
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"CommonHTML": {"undefinedFamily": "\"Source Serif Pro\", \"Yakumono\", \"Noto Serif JP\", \"Hiragino Mincho ProN\", \"STIXGeneral\", \"Arial Unicode MS\", serif"}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>

    <script type="text/javascript" src="../_static/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../_static/sphinx-nefertiti.min.js"></script>
    
    <script type="text/javascript" src="../_static/doc_versions.js"></script>
  </body>
</html>