

<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
      <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="Quantum Native Dojo" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="" />
    <meta name="docsearch:version" content="" />
    
      <title>4-2. Quantum simulation using Trotter decomposition &mdash; Quantum Native Dojo  documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-icons.css" type="text/css" />
          <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e7352e39" />
          <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=e15ddae3" />
          <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
          <link rel="stylesheet" type="text/css" href="../_static/colorsets/sphinx-nefertiti-blue.min.css" />
          <link rel="stylesheet" type="text/css" href="../_static/fonts/nunito/stylesheet.css?v=0ed606bc" />
          <link rel="stylesheet" type="text/css" href="../_static/fonts/red-hat-mono/stylesheet.css?v=4eee5046" />
          <link rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=e15ddae3" />
        <link rel="index" title="Index" href="../genindex.html" />
        <link rel="search" title="Search" href="../search.html" />
        <link rel="top" title="Quantum Native Dojo  documentation" href="#" />
    <style>
      :root {
        --nftt-body-font-family: "Nunito", var(--nftt-font-sans-serif) !important;
        --nftt-font-monospace: "Red Hat Mono", var(--nftt-font-family-monospace) !important;
        --nftt-project-name-font: var(--nftt-body-font-family);
        --nftt-documentation-font: var(--nftt-body-font-family);
        --nftt-doc-headers-font: "Georgia", var(--nftt-documentation-font);}
      h1 *, h2 *, h3 *, h4 *, h5 *, h6 * { font-size: inherit; }
    </style>
  </head>
  <body>
    <header class="navbar navbar-expand-xl navbar-dark nftt-navbar flex-column fixed-top">
      <div class="skip-links container-fluid visually-hidden-focusable overflow-hidden justify-content-start">
        <div class="border-bottom mb-2 pb-2 w-100">
          <a class="d-none d-md-inline-flex p-2 m-1" href="#sidebar-filter">Skip to docs navigation</a>
          <a class="d-inline-flex p-2 m-1" href="#content">Skip to main content</a>
        </div>
      </div>
      <nav class="container-xxl nftt-gutter flex-wrap flex-xl-nowrap" aria-label="Main navigation">
        <div class="nftt-navbar-toggler">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle documentation navigation">
            <i class="bi bi-list"></i>
          </button>
        </div>
          <a href="../index.html"
              
              class="navbar-brand p-0 me-0 md-lg-2"
          ><span class="brand-text">Quantum Native Dojo</span></a>
        
        <div class="d-flex d-xl-none">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttSearch" aria-controls="nfttSearch" aria-label="Search">
            <i class="bi bi-search"></i>
          </button>
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttNavbar" aria-controls="nfttNavbar" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
        
<div class="offcanvas-xl offcanvas-end flex-grow-1" tabindex="-1" id="nfttSearch" aria-labelledby="nfttSearchOffcanvasLabel" data-bs-scroll="true">
  <div class="offcanvas-header px-4 pb-0">
    <h5 class="offcanvas-title fw-bold" id="nfttSearchOffcanvasLabel">Search the documentation</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttSearch"></button>
  </div>
  <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
    <hr class="d-xl-none text-white-50">
    <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
      <li class="nav-item col-12 col-xl-auto">
        <form id="nftt-search-form" action="../search.html" method="get">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search docs" aria-label="Search" aria-describedby="button-search">
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <button class="btn btn-primary" type="submit" id="button-search" aria-label="Search"><i class="bi bi-search"></i></button>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

        <div class="offcanvas-xl offcanvas-end" tabindex="-1" id="nfttNavbar" aria-labelledby="nfttNavbarOffcanvasLabel" data-bs-scroll="true">
          <div class="offcanvas-header px-4 pb-0">
            <div class="offcanvas-title navbar-brand" id="nfttNavbarOffcanvasLabel"><span class="brand-text">Nefertiti for Sphinx</span></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttNavbar"></button>
          </div>
          <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
            <hr class="d-xl-none text-white-50">
            <ul class="navbar-nav flex-row align-items-center flex-wrap ms-lg-auto">
              
              <!-- version_dropdown.html -->

              
              <!-- colorscheme_dropdown.html -->
<li class="nav-item dropdown">
  <a class="nav-link d-flex py-2 px-0 px-xl-2 dropdown-toggle align-items-center" id="snftt-luz" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false" aria-label="Toggle light/dark">
    <i class="bi bi-circle-half" data-snftt-luz-icon-active></i>
    <span id="snftt-luz-text" class="d-xl-none small ms-2">Toggle light/dark</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-luz-text">
    <li>
      <h6 class="dropdown-header">Light/dark</h6>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="light" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-sun" data-snftt-luz-icon="light"></i>
        </span>
        <span class="small ms-3">Light</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="dark" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-moon-stars" data-snftt-luz-icon="dark"></i>
        </span>
        <span class="small ms-3">Dark</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item current d-flex align-items-center" data-snftt-luz="default" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-circle-half" data-snftt-luz-icon="default"></i>
        </span>
        <span class="small ms-3">Default</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
  </ul>
</li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container-fluid">
      <div class="nftt-gutter nftt-page">
        <aside class="nftt-sidebar">
          <div class="nftt-sidebar-content">
            <div class="title d-none d-xl-block">
              <i class="bi bi-book"></i>&nbsp;&nbsp;<span>Index</span>
            </div>
            <div id="sidebar" tabindex="-1" class="offcanvas-xl offcanvas-start" aria-labelledby="nfttSidebarOffcanvasLabel">
                <!-- danirus sidebartemplate: "globaltoc.html" --><div class="offcanvas-header border-bottom">
  <h5 class="offcanvas-title fw-bold" id="nfttSidebarOffcanvasLabel">
    Table of contents
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#sidebar"></button>
</div>

<div class="offcanvas-body">
  <nav class="toc" aria-label="Main menu">
    <div class="mb-3 p-1 pt-3 pb-4 border-bottom">
      <input id="sidebar-filter" type="text" name="filter" class="form-control form-control-sm" placeholder="filter" aria-label="filter">
    </div>
    <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/0_prologue.html">Chapter 0: What is a Quantum Computer ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/1_quantum_information_foundation.html">Chapter 1: Fundamentals of Quantum Information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/1.1_qubit_representation.html">1-1. Qubit Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/1.2_qubit_operations.html">1-2. Qubit Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/1.3_multiqubit_representation_and_operations.html">1-3. Multiqubit representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/1.3_multiqubit_representation_and_operations.html#Column:-What-is-a-universal-gate-set?">Column: What is a universal gate set?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/1.4_quantum_circuit_diagram.html">1-4. Quantum Circuit Diagram</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/2_introduction_to_quantum_algorithms.html">Chapter 2: Introduction to Quantum Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/2.1_NISQ_and_long_term.html">2-1. NISQ algorithm and long-term algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/2.2_Hadamard_test.html">2-2. Hadamard test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/2.3_quantum_Fourier_transform.html">2-3. Quantum Fourier transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/2.4_phase_estimation_beginner.html">2-4. Phase Estimation Algorithm（Introductory）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/3_execution_environments_of_quantum_algorithms.html">Chapter 3: Execution Environment for Quantum Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/3.1_Qulacs_tutorial.html">3-1. Qulacs_tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/3.2_Qiskit_IBMQ.html">3-2. Qiskit_IBMQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/4_quantum_dynamics_simulation.html">Chapter4 Quantum dynamics simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/4.1_quantum_simulation.html">4-1. Quantum Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/4.2_trotter_decomposition.html">4-2. Trotter Decomposition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/5_VQC_based_algorithms.html">Chapter 5 Algorithms Based on Variational Quantum Circuits</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/5.1_variational_quantum_eigensolver.html">5-1. Variational Quantum Eigensolver（VQE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/5.2_Quantum_Circuit_Learning.html">5-2. Quantum Circuit Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/5.3_quantum_approximate_optimazation_algorithm.html">5-3. Quantum Approximate Optimazation Algorithm (QAOA)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/6_quantum_chemistry_calculation.html">Chapter 6 Quantum chemistry calculation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/6.1_openfermion_basics.html">6-1. OpenFermion Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/6.2_qulacs_VQE.html">6-2. Variational Quantum Eigensolver (VQE) Implementation using Qulacs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/6.3_subspace_search_VQE.html">6-3. Calculation of Excited States using Subspace-Search Variational Quantum Eigensolver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/7_quantum_phase_estimation.html">chapter 7 Quantum phase estimation algorithm and its application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/7.1_quantum_phase_estimation_detailed.html">7-1. Quantum Phase Estimation (QPE) Algorithm Detailed：Hydrogen Molecule as Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/7.2_Harrow-Hassidim-Lloyd_algorithm.html">7-2. Harrow-Hassidim-Lloyd (HHL) Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/7.3_application_of_HHL_algorithm.html">7-3. Portofolio Optimization by HHL Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/8_quantum_search_algorithm.html">Chapter 8: Quantum Search Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/8.1_oracle.html">8-1. oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/8.2_Grovers_algorithm.html">8-2. Grover’s algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/9_quantum_error_correction.html">Chapter 9 Quantum Error Correction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/9.1_error_correction.html">9-1. classical error</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/9.2_quantum_error_correction.html">9-2. quantum error</a></li>
</ul>
</li>
</ul>

  </nav>
  <template data-toggle-item-template>
    <button class="btn btn-sm btn-link toctree-expand" type="button">
      <i class="bi bi-caret-right"></i>
      <span class="visually-hidden">Toggle menu contents</span>
    </button>
  </template>
</div>
            </div>
          </div>
        </aside>
        <article id="content" class="nftt-content" role="main">
    <section id="4-2.-Quantum-simulation-using-Trotter-decomposition">
<h1>4-2. Quantum simulation using Trotter decomposition<a class="headerlink" href="#4-2.-Quantum-simulation-using-Trotter-decomposition" title="Link to this heading">¶</a></h1>
<div class="line-block">
<div class="line">In this section, we introduce one method for simulating the dynamics of quantum systems: dynamics simulation based on Trotter decomposition. This method is in a sense the most straightforward method for simulating dynamics, and it works on NISQ devices up to a certain scale of problems.</div>
<div class="line">Here we try to simulate the quantum dynamics of a physical system, and we focus on the 1D transverse field Ising model.</div>
</div>
<section id="Trotter-decomposition">
<h2>Trotter decomposition<a class="headerlink" href="#Trotter-decomposition" title="Link to this heading">¶</a></h2>
<p>The Trotter decomposition is a formula that approximates the exponential function of the sum of square matrices <span class="math notranslate nohighlight">\(A,B\)</span> to the product of their respective exponential functions</p>
<div class="math notranslate nohighlight">
\[e^{\delta (A+B)} = e^{\delta A} \cdot e^{\delta B} +  O\left( \delta^2 \right).\]</div>
<p><span class="math notranslate nohighlight">\(O\)</span> is the order notation introduced in the <a class="reference external" href="2.3_quantum_Fourier_transform.ipynb">Section 2.3</a> column, which represents the approximate accuracy of the approximation. (Note that <span class="math notranslate nohighlight">\(e^{A+B}\neq e^A\cdot e^B\)</span> since <span class="math notranslate nohighlight">\(A,B\)</span> are matrices that don’t necessarily commute).</p>
</section>
<section id="Quantum-simulation-using-Trotter-decomposition">
<h2>Quantum simulation using Trotter decomposition<a class="headerlink" href="#Quantum-simulation-using-Trotter-decomposition" title="Link to this heading">¶</a></h2>
<p>As we learned in the previous section, the time evolution of a quantum state follows the Schrodinger equation <span class="math notranslate nohighlight">\(i\frac{\partial}{\partial t}|\psi(t)\rangle = H|\psi(t)\rangle\)</span> (assuming <span class="math notranslate nohighlight">\(\hbar=1\)</span>). In particular, if the Hamiltonian <span class="math notranslate nohighlight">\(H\)</span> is independent of time, the state after time <span class="math notranslate nohighlight">\(t\)</span> is <span class="math notranslate nohighlight">\(|\psi(t)\rangle = e^{-iHt}|\psi(0)\rangle\)</span> (<span class="math notranslate nohighlight">\(|\psi(0)\rangle\)</span> is the initial state). In other words, in simulating the dynamics of a quantum system, it is enough to calculate
the operator <span class="math notranslate nohighlight">\(e^{-iHt}\)</span>. However, in an <span class="math notranslate nohighlight">\(n\)</span>-qubit system, <span class="math notranslate nohighlight">\(H\)</span> is a <span class="math notranslate nohighlight">\(2^n\)</span>-dimensional, i.e very large, matrix. Therefore, it is difficult to compute this exponential function with a classical computer, and it is also considered difficult to compute the exponential function of any <span class="math notranslate nohighlight">\(2^n\)</span>-dimensional matrix <span class="math notranslate nohighlight">\(H\)</span> with a quantum computer.</p>
<div class="line-block">
<div class="line">However, if the Hamiltonian has a <strong>specific structure</strong>, a quantum computer can compute <span class="math notranslate nohighlight">\(e^{-iHt}\)</span> efficiently. The Trotter decomposition is used for this purpose.</div>
<div class="line">Let us consider a concrete example. Consider an Ising model consisting of <span class="math notranslate nohighlight">\(n\)</span> qubits (see below). The Hamiltonian for this model is given by <span class="math notranslate nohighlight">\(H = \sum_{i=1}^{n-1} Z_i Z_{i+1}\)</span>. Using the Trotter decomposition, we can decompose <span class="math notranslate nohighlight">\(e^{-iH t}\)</span> as</div>
</div>
<div class="math notranslate nohighlight">
\[e^{-iHt} = e^{-i\left(\sum_{i=1}^{n-1} Z_i Z_{i+1}\right) t} = \left(e^{-i(Z_1 Z_2 + Z_2 Z_3 \cdots )\frac{t}{M}}\right)^M
\approx \left(e^{-i(Z_1 Z_2)\frac{t}{M}}\cdot e^{-i(Z_2 Z_3)\frac{t}{M}}\cdot\cdots \right)^M  \tag{1}\]</div>
<div class="line-block">
<div class="line">Let <span class="math notranslate nohighlight">\(M\)</span> be the total number dividing the action of <span class="math notranslate nohighlight">\(e^{-iHt}\)</span>, chosen so that the accuracy of the approximation <span class="math notranslate nohighlight">\(O\left((t/M)^2\right)\)</span> is enough.</div>
<div class="line">If we look at the last equation, we see that we need to perform <span class="math notranslate nohighlight">\(nM\)</span> products of <span class="math notranslate nohighlight">\(e^{-i(Z_i Z_{i+1})\frac{t}{M}}\)</span>, which is a small matrix (2 qubit gates, 4 dimensions). In other words, <strong>the action of an exponentially large matrix could be written as polynomial products of small matrices (2 qubit gates)</strong>.</div>
</div>
<p>Thus, if the Hamiltonian can be written as a sum of a small number of terms, it can be computed at high speed on a quantum computer using the Trotter decomposition.</p>
<p>*Incidentally, most Hamiltonians of interest in physics and quantum chemistry have a form that allows efficient Trotter decomposition.</p>
</section>
<section id="Implementation-of-quantum-dynamics-(1):-Ising-model">
<h2>Implementation of quantum dynamics (1): Ising model<a class="headerlink" href="#Implementation-of-quantum-dynamics-(1):-Ising-model" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Let us consider the Ising model as a concrete system to implement quantum simulation.</div>
<div class="line">(For readers who are not familiar with physics, we will introduce the necessary concepts needed to follow the calculation.)</div>
</div>
<p>The property of matter to respond to a magnetic field is called magnetism, and in the microscopic world, electrons and atomic nuclei have very small magnetic properties, called <strong>spin</strong>. Roughly speaking, we can think of spin as a small magnet. The magnets we see in everyday life are the result of the neat alignment of the small magnetism exhibited by the spins of the electrons (and atomic nuclei) in matter.</p>
<p>The Ising model is a model that describes the behavior of the spins in matter and was invented as a model that extracts the essence of magnets. The definition is as follows:</p>
<div class="math notranslate nohighlight">
\[H = J \sum_{i=1}^{n} Z_i Z_{i+1}\]</div>
<p>where <span class="math notranslate nohighlight">\(J\)</span> is a parameter of the model that determines the strength of the interaction between the spins, <span class="math notranslate nohighlight">\(n\)</span> is the number of particles with spin, and <span class="math notranslate nohighlight">\(Z_i\)</span> is the <span class="math notranslate nohighlight">\(z\)</span>-axis component of the spin of the <span class="math notranslate nohighlight">\(i\)</span>-th particle. As we learned in the previous section, physical quantities are represented by Hermitian operators called observables, so the magnetization (strength of the magnetic force) exhibited by spins is also represented by an operator. Using the <span class="math notranslate nohighlight">\(x,y,z\)</span>
(Cartesian) coordinate system, the magnetization can be written in terms of the Pauli operators are <span class="math notranslate nohighlight">\(X,Y,Z\)</span>. By convention we use the z-direction as the quantization axes which means that <span class="math notranslate nohighlight">\(Z|0\rangle=|0\rangle\)</span>, <span class="math notranslate nohighlight">\(Z|1\rangle= -|1\rangle\)</span>. In other words, the state <span class="math notranslate nohighlight">\(|0\rangle\)</span> corresponds to the spin facing <span class="math notranslate nohighlight">\(+z\)</span> direction and the <span class="math notranslate nohighlight">\(|1\rangle\)</span> corresponds to the spin facing the <span class="math notranslate nohighlight">\(-z\)</span> direction. In what follow we will consider tha that each spin is represented
by a qubit. So the <span class="math notranslate nohighlight">\(i^{th}\)</span> spin = <span class="math notranslate nohighlight">\(i^{th}\)</span> qubit.</p>
<p>The product <span class="math notranslate nohighlight">\(Z_i Z_{i+1}\)</span> in this model represent the interaction between neighboring qubits. When <span class="math notranslate nohighlight">\(J&gt;0\)</span>, <span class="math notranslate nohighlight">\(Z_i Z_{i+1}=1\)</span> for <span class="math notranslate nohighlight">\((Z_i,Z_{i+1})=(1,1),(-1,-1)\)</span> and <span class="math notranslate nohighlight">\(Z_i Z_{i+1}=-1\)</span> for <span class="math notranslate nohighlight">\((Z_i,Z_{i+1})=(1,-1),(-1,1)\)</span>, so the energy is low when the spins point in opposite directions, e.g. <span class="math notranslate nohighlight">\(| 010101\cdots\rangle\)</span>. Conversely, for <span class="math notranslate nohighlight">\(J&lt;0\)</span>, the spin-aligned cases <span class="math notranslate nohighlight">\(|000\cdots\rangle\)</span> and <span class="math notranslate nohighlight">\(|111\cdots\rangle\)</span> have the lowest energy, and the system
behaves as a magnet with a large magnetization.</p>
<p>This model can be easily solved without using a quantum computer, but we will use this model as for a first implementation of the Trotter decomposition. The Trotter decomposition of <span class="math notranslate nohighlight">\(e^{-iHt}\)</span> is derived in equation (1) but what we need is how to implement the gate <span class="math notranslate nohighlight">\(e^{-i \delta Z_i Z_{i+1}}\)</span>. This can be done as follows (we leave the mathematical verification as an exercise):</p>
<div class="math notranslate nohighlight">
\[e^{-i \delta Z_i Z_{i+1}} = \operatorname{CNOT}_{i,i+1} \cdot e^{-i\delta Z_{i+1}} \cdot \operatorname{CNOT}_{i,i+1}.\]</div>
<p>Now, we focus on the physical quantity corresponding to the total magnetization in the z-direction</p>
<div class="math notranslate nohighlight">
\[\left\langle\psi\left|\sum_{i=1}^{n} Z_i\right|\psi\right\rangle\]</div>
<p>and follow its time variation.</p>
<p><strong>The initial state is :math:`|000cdotsrangle` with spin aligned in the</strong> <span class="math notranslate nohighlight">\(+z\)</span> direction, and for convenience, <span class="math notranslate nohighlight">\(Z_{n+1}\)</span> is identified with <span class="math notranslate nohighlight">\(Z_1\)</span>, assuming that the system is periodic.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quri_parts.core.operator</span> <span class="kn">import</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">pauli_label</span><span class="p">,</span> <span class="n">get_sparse_matrix</span>
<span class="kn">from</span> <span class="nn">quri_parts.core.state</span> <span class="kn">import</span> <span class="n">quantum_state</span>
<span class="kn">from</span> <span class="nn">quri_parts.circuit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">quri_parts.qulacs.estimator</span> <span class="kn">import</span> <span class="n">create_qulacs_vector_estimator</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</section>
<section id="id2">
<h2>Implementation of quantum dynamics (1): Ising model<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>In this section, we will be using QURI Parts to perform the simulation. Please check out the <a class="reference external" href="https://quri-parts.qunasys.com/">QURI Parts documentation page</a> first for tutorials on how to perform <a class="reference external" href="https://quri-parts.qunasys.com/tutorials/estimator_basics">expectation value estimation</a> and <a class="reference external" href="https://quri-parts.qunasys.com/tutorials/circuits">construct quantum circuits</a> with QURI Parts.</p>
<p>Here, we consider a system with six particles, which corresponds to six qubits in this case. Then, we simulate the system over 1 second with</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">6</span>
<span class="c1"># Time to simulate dynamics</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1"># Number of divisions of Trotter decomposition</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Time increment range</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">M</span>
</pre></div>
</div>
</div>
<p>The observable which we want to evaluate its expectation value is the magnetization given by:</p>
<div class="math notranslate nohighlight">
\[M = \frac{1}{6}\sum_{i=1}^{6}Z_{i}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Prepare observable for all magnetizations.</span>
<span class="n">magnetization_obs</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">pauli_label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Z</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="o">/</span><span class="n">n_qubits</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">magnetization_obs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="si">}</span><span class="s2"> * </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.16666667 * Z0
0.16666667 * Z1
0.16666667 * Z2
0.16666667 * Z3
0.16666667 * Z4
0.16666667 * Z5
</pre></div></div>
</div>
<p>Then, we prepare the initial state <span class="math notranslate nohighlight">\(|000000\rangle\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">quantum_state</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we construct the time evolution operator with a quantum circuit. In this tutorial, we build it by converting the one Trotter decomposition Hamiltonian</p>
<div class="math notranslate nohighlight">
\[e^{iZ_1Z_2\delta}e^{iZ_2Z_3\delta}...e^{iZ_nZ_1\delta}\]</div>
<p>into a quantum circuit and apply it to the initial state repeatedly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit_trotter_Ising</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">):</span>
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_CNOT_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>)
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_RZ_gate</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>, -2*delta)  # Note that the RZ gate is given by exp(-i *delta / 2) in QURI Parts
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_CNOT_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>)
</pre></div>
</div>
</div>
<p>We are now ready to simulate the system’s time evolution</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quri_parts.core.state</span> <span class="kn">import</span> <span class="n">apply_circuit</span>

<span class="c1"># An estimator needs to be created for expectation value estimation</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">create_qulacs_vector_estimator</span><span class="p">()</span>

<span class="c1"># A list that records time and magnetization</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">delta</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1">#Calculate total magnetization at t=0</span>
<span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="c1">#Calculate total magnetization after t=0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="c1"># Time evolution by delta=t/M</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span>
        <span class="n">state</span><span class="o">.</span><span class="n">qubit_count</span><span class="p">,</span> <span class="n">gates</span><span class="o">=</span><span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">gates</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">state_i</span> <span class="o">=</span> <span class="n">apply_circuit</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="c1"># Calculate and record magnetization</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">state_i</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="c1">#Drawing a graph</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Value of magnetization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dynamics of Ising model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/daniel/anaconda3/envs/qp_dev/lib/python3.9/site-packages/matplotlib/cbook/__init__.py:1335: ComplexWarning: Casting complex values to real discards the imaginary part
  return np.asarray(x, float)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/qp_notebooks_4.2_qp_trotter_decomposition_14_1.png" src="../_images/qp_notebooks_4.2_qp_trotter_decomposition_14_1.png" />
</div>
</div>
<p>As can be seen in this result, the total magnetization in the <span class="math notranslate nohighlight">\(z\)</span> direction is constant (also note the scale of the vertical axis). In fact, since the Ising model only interacts in the <span class="math notranslate nohighlight">\(z\)</span> direction, the magnetization in the <span class="math notranslate nohighlight">\(z\)</span> direction is also conserved. This is not interesting, so let us now look at the time evolution of the transverse magnetic field Ising model with a magnetic field in the <span class="math notranslate nohighlight">\(x\)</span> direction.</p>
</section>
<section id="Implementation-of-Quantum-Dynamics-(2):-Transverse-Magnetic-Field-Ising-Model">
<h2>Implementation of Quantum Dynamics (2): Transverse Magnetic Field Ising Model<a class="headerlink" href="#Implementation-of-Quantum-Dynamics-(2):-Transverse-Magnetic-Field-Ising-Model" title="Link to this heading">¶</a></h2>
<p>Let’s consider a transverse magnetic field Ising model with a uniform magnetic field along the <span class="math notranslate nohighlight">\(x\)</span> axis applied to the Ising model.</p>
<div class="math notranslate nohighlight">
\[H = \sum_{i=1}^n Z_i Z_{i+1} + h\sum_{i=1}^n X_i\]</div>
<p>The <span class="math notranslate nohighlight">\(h\)</span> is a coefficient representing the strength of the transverse magnetic field, and <span class="math notranslate nohighlight">\(X_i\)</span> is the Pauli operator (observable) representing the magnetization of the <span class="math notranslate nohighlight">\(i\)</span>th particle in the <span class="math notranslate nohighlight">\(x\)</span> direction.</p>
<div class="line-block">
<div class="line">If we perform the Trotter decomposition in this model, we will add the term <span class="math notranslate nohighlight">\(e^{-ih X_1 \frac{t}{M}} \cdots e^{-ih X_n \frac{t}{M}}\)</span> in addition to the Ising model described earlier.</div>
<div class="line">Now let’s actually look at the total magnetization in this model.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In this case, we consider a system with six particles.</span>
<span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">6</span>
<span class="c1">#  Time to simulate dynamics</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="c1"># Number of divisions of Trotter decomposition</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Time increment range</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">M</span>
<span class="c1">## Transverse magnetic field strength</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">3.</span>

<span class="c1">## Prepare observable for all magnetizations.</span>
<span class="n">magnetization_obs</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">pauli_label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Z</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="o">/</span><span class="n">n_qubits</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1">## The initial state is |000000&gt;</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">quantum_state</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>

<span class="c1"># Convert one Trotter decomposition ,e^{iZ_1Z_2*delta}*e^{iZ_2Z_3*delta}*...e^{iZ_nZ_1*delta} to a quantum gate</span>
<span class="n">circuit_trotter_Ising</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">):</span>
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_CNOT_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>)
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_RZ_gate</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>, -2*delta)  # Note that the RZ gate is given by exp(-i *delta / 2) in QURI Parts
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_CNOT_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>)
    <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_RX_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>


<span class="c1">## A list that records time and magnetization</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">delta</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1">#Calculate total magnetization at t=0</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">create_qulacs_vector_estimator</span><span class="p">()</span>
<span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>


<span class="c1">#Calculate total magnetization after t=0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="c1"># Time evolution by delta=t/M</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">qubit_count</span><span class="p">,</span> <span class="n">gates</span><span class="o">=</span><span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">gates</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">state_i</span> <span class="o">=</span> <span class="n">apply_circuit</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="c1"># Calculate and record magnetization</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">state_i</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>


<span class="c1">#Drawing a graph</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Value of magnetization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dynamics of Ising model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/qp_notebooks_4.2_qp_trotter_decomposition_17_0.png" src="../_images/qp_notebooks_4.2_qp_trotter_decomposition_17_0.png" />
</div>
</div>
<p>The Ising model with <span class="math notranslate nohighlight">\(h=0\)</span> has a constant total magnetization, whereas the transverse field Ising model with a transverse magnetic field of <span class="math notranslate nohighlight">\(h=3\)</span> has a significant difference in that the value of total magnetization changes over time and even drops to a negative value. This can be thought of as the transverse magnetic field (magnetic field in the <span class="math notranslate nohighlight">\(x\)</span> direction) causing the spins that were aligned in the <span class="math notranslate nohighlight">\(z\)</span> direction to become disorganized and disordered, resulting in a
change in the value of total magnetization. If you are interested, try to calculate with a stronger <span class="math notranslate nohighlight">\(h\)</span> value, and you will see that the speed of magnetization decrease becomes faster.</p>
</section>
<section id="Implementation-of-quantum-dynamics-(3):-Comparison-with-exact-solution">
<h2>Implementation of quantum dynamics (3): Comparison with exact solution<a class="headerlink" href="#Implementation-of-quantum-dynamics-(3):-Comparison-with-exact-solution" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">expm</span>
<span class="kn">from</span> <span class="nn">quri_parts.core.state</span> <span class="kn">import</span> <span class="n">CircuitQuantumState</span>

<span class="c1"># In this case, we consider a system with six particles.</span>
<span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">6</span>
<span class="c1">#  Time to simulate dynamics</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="c1"># Number of divisions of Trotter decomposition</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Time increment range</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">M</span>

<span class="c1"># Transverse magnetic field strength</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">3.</span>

<span class="c1">## Prepare observable for all magnetizations.</span>
<span class="n">magnetization_obs</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">pauli_label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Z</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Prepare expectation value estimator</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">create_qulacs_vector_estimator</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_trotter_time_evolution_circuit</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert one Trotter decomposition:</span>

<span class="sd">        e^{iZ_1Z_2*delta}*e^{iZ_2Z_3*delta}*...e^{iZ_nZ_1*delta}</span>

<span class="sd">    to a quantum gate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">circuit_trotter_Ising</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">):</span>
        <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_CNOT_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>)
        <span class="c1"># Note that the RZ gate is given by exp(-i *delta / 2) in QURI Parts</span>
        <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_RZ_gate</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>, -2*delta)
        <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_CNOT_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">n_qubits</span>)
        <span class="n">circuit_trotter_Ising</span><span class="o">.</span><span class="n">add_RX_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circuit_trotter_Ising</span>

<span class="k">def</span> <span class="nf">get_exact_time_evolution_circuit</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build hamiltonian and the exact time evolution circuit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Build Hamiltonian</span>
    <span class="n">hamiltonian</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">):</span>
        <span class="n">hamiltonian</span><span class="o">.</span><span class="n">add_term</span><span class="p">(</span><span class="n">pauli_label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Z</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> Z</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n_qubits</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">hamiltonian</span><span class="o">.</span><span class="n">add_term</span><span class="p">(</span><span class="n">pauli_label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">hamiltonian_matrix</span> <span class="o">=</span> <span class="n">get_sparse_matrix</span><span class="p">(</span><span class="n">hamiltonian</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>

    <span class="c1"># Exact time evolution circuit</span>
    <span class="n">exp_h</span> <span class="o">=</span> <span class="n">expm</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">hamiltonian_matrix</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
    <span class="n">circuit_exact_Ising</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
    <span class="n">circuit_exact_Ising</span><span class="o">.</span><span class="n">add_UnitaryMatrix_gate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">),</span> <span class="n">exp_h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">circuit_exact_Ising</span>

<span class="k">def</span> <span class="nf">run_time_evolution</span><span class="p">(</span>
    <span class="n">initial_state</span><span class="p">:</span> <span class="n">CircuitQuantumState</span><span class="p">,</span>
    <span class="n">trotter_time_evo_circuit</span><span class="p">:</span> <span class="n">QuantumCircuit</span><span class="p">,</span>
    <span class="n">exact_time_evo_circuit</span><span class="p">:</span> <span class="n">QuantumCircuit</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run both Trotter and exact time evolution</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># A list that records time and magnetization</span>
    <span class="n">y_trotter</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_exact</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#Calculate total magnetization at t=0</span>
    <span class="n">y_trotter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">y_exact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

    <span class="c1">#Calculate total magnetization after t=0</span>
    <span class="n">n_qubits</span> <span class="o">=</span> <span class="n">init_state</span><span class="o">.</span><span class="n">qubit_count</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
        <span class="c1"># Time evolution by delta=t/M</span>
        <span class="n">exact_circuit_i</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">exact_time_evo_circuit</span><span class="o">.</span><span class="n">gates</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">exact_state_i</span> <span class="o">=</span> <span class="n">apply_circuit</span><span class="p">(</span><span class="n">exact_circuit_i</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>

        <span class="n">trotter_circuit_i</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">trotter_time_evo_circuit</span><span class="o">.</span><span class="n">gates</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">trotter_state_i</span> <span class="o">=</span> <span class="n">apply_circuit</span><span class="p">(</span><span class="n">trotter_circuit_i</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>

        <span class="c1"># Calculate and record magnetization</span>
        <span class="n">y_exact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">exact_state_i</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">y_trotter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator</span><span class="p">(</span><span class="n">magnetization_obs</span><span class="p">,</span> <span class="n">trotter_state_i</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">y_trotter</span><span class="p">,</span> <span class="n">y_exact</span>

<span class="c1">## Intitial state set to be |000000&gt;</span>
<span class="n">init_state</span> <span class="o">=</span> <span class="n">quantum_state</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="n">circuit_exact_Ising</span> <span class="o">=</span> <span class="n">get_exact_time_evolution_circuit</span><span class="p">()</span>
<span class="n">circuit_trotter_Ising</span> <span class="o">=</span> <span class="n">get_trotter_time_evolution_circuit</span><span class="p">()</span>

<span class="n">y_trotter</span><span class="p">,</span> <span class="n">y_exact</span> <span class="o">=</span> <span class="n">run_time_evolution</span><span class="p">(</span><span class="n">init_state</span><span class="p">,</span> <span class="n">circuit_trotter_Ising</span><span class="p">,</span> <span class="n">circuit_exact_Ising</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">delta</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="c1">#Drawing a graph</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Value of magnetization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dynamics of transverse Ising model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_trotter</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trotter&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_exact</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/qp_notebooks_4.2_qp_trotter_decomposition_20_0.png" src="../_images/qp_notebooks_4.2_qp_trotter_decomposition_20_0.png" />
</div>
</div>
<p>In this range, it seems that they are almost the same. Let’s look at the error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Drawing a graph</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Value of magnetization&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_trotter</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_exact</span><span class="p">)),</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trotter&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/qp_notebooks_4.2_qp_trotter_decomposition_22_0.png" src="../_images/qp_notebooks_4.2_qp_trotter_decomposition_22_0.png" />
</div>
</div>
<p>We recommend interested readers to decrease division numbers <span class="math notranslate nohighlight">\(M\)</span> and increase time <span class="math notranslate nohighlight">\(t\)</span>.</p>
</section>
</section>

</article>
        <aside class="nftt-toc">
          
          <div class="mt-3 mb-1 my-lg-0 ps-xl-3 text-muted">
            <button class="btn btn-link link-dark p-lg-0 mb-2 mb-lg-0 text-decoration-none nftt-toc-toggle d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#tocContents" aria-expanded="false" aria-controls="tocContents"
            >On this page <i class="ms-2 bi bi-chevron-expand"></i></button>
            <div class="title d-none d-lg-block">
              <i class="bi bi-file-earmark-text"></i>&nbsp;&nbsp;<span class="small">On this page</span>
            </div>
            <div class="collapse nftt-toc-collapse" id="tocContents">
              <nav id="TableOfContents">
                <ul>
<li><a class="reference internal" href="#">4-2. Quantum simulation using Trotter decomposition</a><ul>
<li><a class="reference internal" href="#Trotter-decomposition">Trotter decomposition</a></li>
<li><a class="reference internal" href="#Quantum-simulation-using-Trotter-decomposition">Quantum simulation using Trotter decomposition</a></li>
<li><a class="reference internal" href="#Implementation-of-quantum-dynamics-(1):-Ising-model">Implementation of quantum dynamics (1): Ising model</a></li>
<li><a class="reference internal" href="#id2">Implementation of quantum dynamics (1): Ising model</a></li>
<li><a class="reference internal" href="#Implementation-of-Quantum-Dynamics-(2):-Transverse-Magnetic-Field-Ising-Model">Implementation of Quantum Dynamics (2): Transverse Magnetic Field Ising Model</a></li>
<li><a class="reference internal" href="#Implementation-of-quantum-dynamics-(3):-Comparison-with-exact-solution">Implementation of quantum dynamics (3): Comparison with exact solution</a></li>
</ul>
</li>
</ul>

              </nav>
            </div>
          </div>
          
        </aside>
      </div>
    </div>

    <footer class="nftt-footer">
      
<nav id="paginator"></nav>

      <div class="py-5 px-4 px-md-3">
  <div class="container">
    

    <div class="row">
      <div class="col-lg-12 text-center">
        <a class="brand-text d-inline-flex align-items-center mb-2 text-decoration-none" href="/" aria-label="Nefertiti-for-Sphinx">
          <span class="fs-6 fw-bold">Quantum Native Dojo</span>
        </a>
        
          <ul class="list-unstyled small text-muted">
            <li>2023, Quantum Native Dojo Contributors</li>
          </ul>
        
        
        <div class="built-with pt-2">
          Built with <a href="http://sphinx-doc.org">Sphinx 7.2.6</a> and <a href="https://github.com/danirus/sphinx-nefertiti">Nefertiti 0.3.0</a>
        </div>
        
      </div>
    </div>
  </div>
</div>
    </footer>
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"CommonHTML": {"undefinedFamily": "\"Source Serif Pro\", \"Yakumono\", \"Noto Serif JP\", \"Hiragino Mincho ProN\", \"STIXGeneral\", \"Arial Unicode MS\", serif"}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>

    <script type="text/javascript" src="../_static/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../_static/sphinx-nefertiti.min.js"></script>
    
    <script type="text/javascript" src="../_static/doc_versions.js"></script>
  </body>
</html>